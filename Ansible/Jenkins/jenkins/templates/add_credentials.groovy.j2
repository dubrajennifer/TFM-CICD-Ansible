// add_credentials.groovy.j2
import com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl
import com.cloudbees.plugins.credentials.CredentialsScope
import hudson.util.Secret

def domain = com.cloudbees.plugins.credentials.domains.Domain.global()
def credsStore = Jenkins.instance.getExtensionList('com.cloudbees.plugins.credentials.SystemCredentialsProvider')[0].getStore()

def credentials = [
{% for userpass in usernamePassword %}
    [id: "{{ userpass.id }}", username: "{{ userpass.username }}", password: "{{ userpass.password }}"],
{% endfor %}
]

for (cred in credentials) {
    def username = cred.username
    def password = Secret.fromString(cred.password)

    def credImpl = new UsernamePasswordCredentialsImpl(
        CredentialsScope.GLOBAL,
        cred.id,
        cred.id,
        "Username/Password credentials",
        username,
        password
    )

    credsStore.addCredentials(domain, credImpl)
}

println "Credentials added successfully"
